# –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase Storage

## üö® –û—à–∏–±–∫–∞ 400 (Bad Request) - –†–µ—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É `400 (Bad Request)` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

## –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö buckets

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://supabase.com/dashboard)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ `database/check-storage.sql`:

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ buckets
SELECT 
  id, 
  name, 
  public, 
  file_size_limit, 
  allowed_mime_types,
  created_at
FROM storage.buckets 
ORDER BY created_at DESC;
```

## –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ bucket —á–µ—Ä–µ–∑ Dashboard

–ï—Å–ª–∏ bucket `dish-images` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **Storage** –≤ Supabase Dashboard
2. –ù–∞–∂–º–∏—Ç–µ **"New bucket"**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **Name**: `dish-images`
   - **Public bucket**: ‚úÖ **–í–∫–ª—é—á–µ–Ω–æ** (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
   - **File size limit**: `5 MB`
   - **Allowed MIME types**: `image/jpeg,image/jpg,image/png,image/webp`
4. –ù–∞–∂–º–∏—Ç–µ **"Create bucket"**

## –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. –í —Ä–∞–∑–¥–µ–ª–µ **Storage** –Ω–∞–π–¥–∏—Ç–µ bucket `dish-images`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Policies"**
3. –ù–∞–∂–º–∏—Ç–µ **"New Policy"**

### –°–æ–∑–¥–∞–π—Ç–µ 4 –ø–æ–ª–∏—Ç–∏–∫–∏:

**–ü–æ–ª–∏—Ç–∏–∫–∞ 1 - –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ:**
- **Policy name**: `Public read access`
- **Operation**: `SELECT`
- **Target roles**: `public`
- **Policy definition**: `bucket_id = 'dish-images'`

**–ü–æ–ª–∏—Ç–∏–∫–∞ 2 - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤:**
- **Policy name**: `Public upload access`
- **Operation**: `INSERT`
- **Target roles**: `public`
- **Policy definition**: `bucket_id = 'dish-images'`

**–ü–æ–ª–∏—Ç–∏–∫–∞ 3 - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:**
- **Policy name**: `Public update access`
- **Operation**: `UPDATE`
- **Target roles**: `public`
- **Policy definition**: `bucket_id = 'dish-images'`

**–ü–æ–ª–∏—Ç–∏–∫–∞ 4 - –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:**
- **Policy name**: `Public delete access`
- **Operation**: `DELETE`
- **Target roles**: `public`
- **Policy definition**: `bucket_id = 'dish-images'`

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è bucket –∏ –ø–æ–ª–∏—Ç–∏–∫:

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–Ω–æ–≤–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ bucket `dish-images` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø—É–±–ª–∏—á–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–æ–∑–¥–∞–Ω—ã –≤—Å–µ 4 –ø–æ–ª–∏—Ç–∏–∫–∏

## –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å bucket —Å –¥—Ä—É–≥–∏–º –∏–º–µ–Ω–µ–º:

1. –°–æ–∑–¥–∞–π—Ç–µ bucket —Å –∏–º–µ–Ω–µ–º `images` –≤–º–µ—Å—Ç–æ `dish-images`
2. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –≤ `lib/storage.ts`:

```typescript
// –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:
.from('dish-images')
// –ù–∞:
.from('images')
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç

- [ ] Bucket `dish-images` —Å–æ–∑–¥–∞–Ω
- [ ] Bucket –ø—É–±–ª–∏—á–Ω—ã–π (public = true)
- [ ] –°–æ–∑–¥–∞–Ω—ã 4 –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] –í—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ —Ä–æ–ª–∏ `public`
- [ ] –õ–∏–º–∏—Ç —Ñ–∞–π–ª–∞: 5MB
- [ ] –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã: JPEG, PNG, WebP
